#!/usr/bin/env bash

set -o errexit
set -o pipefail

if [[ -z $1 ]]; then
    exit 1
fi

if [[ -n $2 ]]; then
    host="$1"
    port="$2"
else
    host="127.0.0.1"
    port="$1"
fi

echo "testing $host:$port"

set +o errexit
timeout 1 bash -c "</dev/tcp/$host/$port"
state="$?"
set -o errexit

if [[ $state = 0 ]]; then
    echo "success"
elif [[ $state = 124 ]]; then
    echo "timeout"
else
    echo "failed with exit code: ${state}"
    # https://www.gnu.org/software/coreutils/manual/html_node/timeout-invocation.html
fi
